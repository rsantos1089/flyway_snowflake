docker pull redgate/flyway
docker run -it --rm --entrypoint /bin/bash redgate/flyway


#user:ADMIN
#pass:Admin123456789
#https://lzuanyu-gcc25290.snowflakecomputing.com/console/login.
CREATE USER FLYWAY_USER;
CREATE OR REPLACE DATABASE DEVOPS;
CREATE OR REPLACE SCHEMA FLYWAY;
CREATE WAREHOUSE WH_DEVOPS WITH WAREHOUSE_SIZE = 'XSMALL' WAREHOUSE_TYPE = 'STANDARD' AUTO_SUSPEND = 60 AUTO_RESUME = TRUE;
ALTER USER FLYWAY_USER SET DEFAULT_ROLE='FLYWAY';
ALTER USER FLYWAY_USER SET DEFAULT_WAREHOUSE='WH_DEVOPS';

###################

docker run --rm -e JAVA_OPTS="-Djava.awt.headless=true" -v ~/flyway/sql/co:/flyway/sql redgate/flyway -url=jdbc:snowflake://ap44255-aws_cenco_co_test.snowflakecomputing.com?authenticator=externalbrowser -user='rudyenrique.enerosantos@externos-cl.cencosud.com' -schemas=flyway migrate
docker run --rm -e JAVA_OPTS="-Djava.awt.headless=true" -v ~/flyway/sql/co:/flyway/sql redgate/flyway -url=jdbc:snowflake://ap44255-aws_cenco_co_test.snowflakecomputing.com -user=GGG_ARQUITECTURA_CORPORATIVA -schemas=flyway migrate


#########################
### linked user via ssh
### https://docs.snowflake.com/en/user-guide/key-pair-auth
########################
openssl genrsa 2048 | openssl pkcs8 -topk8 -inform PEM -out rsa_key.p8 -nocrypt
openssl rsa -in rsa_key.p8 -pubout -out rsa_key.pub
copy value from rsa_key.pub to FLYWAY_USER
#setting user to flyway in snowflake
create user FLYWAY_USER
create role FLYWAY
ALTER USER FLYWAY_USER SET JDBC_QUERY_RESULT_FORMAT='JSON';
ALTER USER FLYWAY_USER SET RSA_PUBLIC_KEY = '<rsa_key.pub>';
ALTER USER FLYWAY_USER UNSET password;
DESCRIBE USER FLYWAY_USER

docker run -v ~/.ssh/id_rsa:/root/.ssh/id_rsa:ro -v ~/.ssh/id_rsa.pub:/root/.ssh/id_rsa.pub:ro my_image ssh user@remote_host

#execute flyway command
docker run --rm -v C:/Users/ENRIQUE/PycharmProjects/flyway_snowflake/rsa_key.p8:/root/.ssh/rsa_key.p8 -v C:/Users/ENRIQUE/PycharmProjects/flyway_snowflake/rsa_key.pub:/root/.ssh/rsa_key.pub -v C:/Users/ENRIQUE/PycharmProjects/flyway_snowflake/flyway/sql/co/:/flyway/sql redgate/flyway -url='jdbc:snowflake://lzuanyu-gcc25290.snowflakecomputing.com:443?db=DEVOPS&warehouse=WH_DEVOPS&private_key_file=/root/.ssh/rsa_key.p8' -user=FLYWAY_USER -password= -schemas=FLYWAY migrate
